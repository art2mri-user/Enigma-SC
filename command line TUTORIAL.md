## Command Line Tutorial

### Use this alternative only if you cannot install the GUI for some reason

To visualize the MENU, open a terminal inside of the **Enigma-SC** folder and type: `./nographmode.sh` 

!["nographmode MENU"](img/command1.png)  

The user should follow the numeric sequence of the numbers in green **(1 - 2 - 3 - 5 - 7 - 8)**. The numbers in yellow (4 and 6) only must be triggered in special ocasions (number 4 and 6 only for those images which failed on step number 3 and 5) and number 9 (to open this tutorial page).  


### 1. Prepare Folders  

Before typing this option, the user should create an **output** folder (you can choose any name, without spaces) where all the files generated on the following steps will be placed in. The **input** folder must have all the .nii.gz files you want to process (only the .nii.gz files) and they will be selected automatically. Your **input** folder can be also a BIDS dataset (all the anatomical data name must end with T1w.nii.gz, for example: sub-01_T1w.nii.gz or sub-02_T1w.nii.gz)  

After type 1 on the terminal, the user will be asked to choose the input files option (.nii.gz or BIDS). After the choice, the path of the **output** folder will be asked, and the entire path must be given, for example: **/home/art2mri/Documents/output** If you don't know how to find the path, open a terminal inside of the output folder and type **pwd** After that, the input folder path will be asked, type the entire path, for example: **/home/art2mri/Documents/input** 

<p align="center">
  <img src="/img/command2.png" />
</p> 

After that, the folders will be prepared and once it is finished you will see a report of the selected files. The output folder will be now your **PREPARED FOLDER**.  

<p align="center">
  <img src="/img/command3.png" />
</p>  

### 2. Spinal Cord Segmentation  

By typing this option, the **Enigma-SC** will run automatically the `sct_deepseg` function of the [Spinal Cord Toolbox](https://spinalcordtoolbox.com/user_section/command-line.html) over each image you selected on the previous step. 

The user can choose between **Docker** and **Singularity/Apptainer** container platforms. After that, the path of the **PREPARED FOLDER** will be asked, give the entire path. If **Singularity/Apptainer** was the choice, before the prepared folder, the path of the **Enigma-SC** will be asked; give the entire path, for example: **/home/art2mri/Documents/Enigma-SC** 

<p align="center">
  <img src="/img/command4.png" />
</p>  

Once the process is finished, a report will be generated in the terminal informing whether it was successful for each selected file. This report will also be saved in a .txt file within the **PREPARED FOLDER**.  

### 3 and 4. Spinal Cord Segmentation  

The **Vertebral Labeling** can be performed in two ways, either by the **Automated** option or by the **Manual** option. We strongly recommend running the **Automated** button and using the **Manual** button only for those images that show misidentification of the spinal cord levels in the masks generated by the **Automated** vertebral labeling.  

The **Automated** method will predict a segmentation mask for each .nii.gz file, using a [nnunetv2](https://github.com/MIC-DKFZ/nnUNet) model trained from our pipeline according to this [paper](). After that, a seg_labeled.nii.gz file will be created and placed inside of the corresponding folder of each individual inside of the **PREPARED FOLDER**. 

For this step, it is beneficial to run the predictions using GPU, because it will significantly accelerate the the segmentation mask generation process. A GPU (graphics processing unit) is a processor made up of many cores. By working together, the cores can process data faster than a CPU (central processing unit), due to parallel execution of tasks. If you don't have a GPU, the procedure will take longer to complete but can still be done using the CPU. Initially, the [nnunetv2](https://github.com/MIC-DKFZ/nnUNet) model predictions will automatically attempt to perform this task using the GPU. If your GPU is not available for this step, a brief notification will appear everytime a new prediction starts (for each individual you have selected) , and it will automatically switch to the CPU. To check if your GPU has been correctly installed, please check [Installation Instructions](/Installation%20Instructions.md). If you are having GPU related problems, please check [here](/GPU%20related%20problems.md) how to fix it. Also note that GPU used on a shared cluster is generally controlled by a server administrator, so if you are not sure about the presence of a GPU and how to use it, please reach out to your server administrator.  

!["fig11"](/img/fig11.png)  

If you choose to run the **Manual** method, for each incorrect segmentation generated by the **Automated** method, simply click the **Manual** button and select, in the file dialog box, all the folders within the **PREPARED FOLDER** folder corresponding to the images you want to correct. Immediately after this, the [Manual Labeling](https://spinalcordtoolbox.com/user_section/tutorials/registration-to-template/vertebral-labeling/manual-labeling-c2c3.html) method of the Spinal Cord Toolbox will start. You will be asked to manually select the location of the C2 and C3 vertebrae (by clicking), for each individual you have selected from the **PREPARED FOLDER** folder.  

Once the labeling process is finished, it is important to check visually if the results correspond to the anatomical landmarks. You can check an anatomical reference image to compare your results in the section [Anatomical Ground Truth](/Anatomical%20Ground%20Truth.md). The image below shows how to access the labeled file generated previously.  

!["fig12"](/img/fig12.png)  

### 5 and 6. Spinal Cord Registration   



